import{u as x,E as k,i as v,a as w,b as S,c as L,d as O}from"./installCanvasRenderer-D8Ld7rAI.js";import{d as I,K as A,a_ as D,r as E,j as y,b5 as U,o as W,b6 as q,U as K,l as R,k as j,a as z,f,D as P,b7 as V,t as B,A as J}from"./index-B_v6adOj.js";import{i as G,b as H,a as M,f as Q,d as F,e as N,g as X,l as Y}from"./chartZoom-VPVfHurq.js";const C="Profit",tt=I({__name:"CumProfitChart",props:{trades:{},openTrades:{default:()=>[]},showTitle:{type:Boolean,default:!0},profitColumn:{default:"profit_abs"}},setup(b){x([G,H,v,w,M,Q,S,L,O]);const s=b,p=A(),g=D(),m=E(),h=y(()=>s.openTrades.reduce((t,a)=>t+(a.total_profit_abs??a[s.profitColumn]??0),0)),d=y(()=>{const t={},a=s.trades.slice().sort((n,c)=>n.close_timestamp>c.close_timestamp?1:-1);let o=0,_=!0;for(let n=0,c=a.length;n<c;n+=1){const e=a[n];_&&(_=!1,t[e.open_timestamp]?t[e.open_timestamp][e.botId]=o:t[e.open_timestamp]={profit:o,[e.botId]:o}),e.close_timestamp&&e[s.profitColumn]&&(o+=e[s.profitColumn],t[e.close_timestamp]?(t[e.close_timestamp].profit+=e[s.profitColumn],t[e.close_timestamp][e.botId]?t[e.close_timestamp][e.botId]+=e[s.profitColumn]:t[e.close_timestamp][e.botId]=o):t[e.close_timestamp]={profit:o,[e.botId]:o})}const l=Object.entries(t).map(([n,c])=>({date:parseInt(n,10),profit:c.profit}));if(s.openTrades.length>0){let n=0,c=0;if(l.length>0){const T=l[l.length-1];n=T.profit??0,c=T.date??0}else c=s.openTrades[0].open_timestamp;const e=(n??0)+h.value;l.push({date:c,currentProfit:n});const Z=Date.now()+24*60*60*1e3;l.push({date:Z,currentProfit:e})}return l});function r(t=!1){const{colorProfit:a,colorLoss:o}=g;return{dataset:{dimensions:["date","profit","currentProfit"],source:d.value},series:[{type:"line",name:"currentProfit",animation:t,lineStyle:{color:h.value>0?a:o,type:"dotted"},itemStyle:{color:h.value>0?a:o},encode:{x:"date",y:"currentProfit"}},{type:"line",name:C,animation:t,step:"end",lineStyle:{color:p.chartTheme==="dark"?"#c2c2c2":"black"},itemStyle:{color:p.chartTheme==="dark"?"#c2c2c2":"black"},encode:{x:"date",y:"profit"}}]}}function i(t=!1){var o;const a=r(t);(o=m.value)==null||o.setOption(a,{replaceMerge:["series","dataset"]})}const u=U(()=>s.trades,()=>{const t={title:{text:"Cumulative Profit",left:"center",show:s.showTitle},backgroundColor:"rgba(0, 0, 0, 0)",tooltip:{trigger:"axis",formatter:o=>{const _=o[0].data.profit,l=o[0].data.currentProfit,n=l?`Projected profit (incl. unrealized): ${P(l,3)}`:`Profit: ${P(_,3)}`;return`${V(o[1].data.date)}<br />${o[1].marker}${n}`},axisPointer:{type:"line",label:{backgroundColor:"#6a7985"}}},legend:{data:[C],right:"5%",selectedMode:!1},useUTC:!1,xAxis:{type:"time"},yAxis:[{type:"value",name:C,splitLine:{show:!1},nameRotate:90,nameLocation:"middle",nameGap:40}],grid:{...N},dataZoom:[{type:"inside",start:0,end:100},{bottom:10,start:0,end:100,...F}]},a=r(!1);return t.series=a.series,t.dataset=a.dataset,t});return W(()=>{}),q(()=>s.openTrades,()=>{i()},{throttle:60*1e3}),K(()=>p.chartTheme,()=>{u.trigger()}),(t,a)=>t.trades?(z(),R(f(k),{key:0,ref_key:"chart",ref:m,option:f(u),theme:f(p).chartTheme,autoresize:""},null,8,["option","theme"])):j("",!0)}}),nt=B(tt,[["__scopeId","data-v-f6dbd9ad"]]),$="Profit %",et="#9be0a8",ot=I({__name:"TradesLogChart",props:{trades:{required:!0,type:Array},showTitle:{default:!0,type:Boolean}},setup(b){x([G,H,v,w,M,S,L,O,X,Y]);const s=b,p=A(),g=D(),m=y(()=>{const d=[],r=s.trades.slice(0).sort((i,u)=>i.close_timestamp>u.close_timestamp?1:-1);for(let i=0,u=r.length;i<u;i+=1){const t=r[i],a=[i,(t.profit_ratio*100).toFixed(2),t.pair,t.botName,J(t.close_timestamp),t.is_short===void 0||!t.is_short?"Long":"Short"];d.push(a)}return d}),h=y(()=>{const d=m.value.length>0?(1-50/m.value.length)*100:100;return{title:{text:"Trades log",left:"center",show:s.showTitle},backgroundColor:"rgba(0, 0, 0, 0)",dataset:{dimensions:["date","profit"],source:m.value},tooltip:{trigger:"axis",formatter:r=>{const i=r[0].data[3]?` | ${r[0].data[3]}`:"";return`${r[0].data[2]} | ${r[0].data[5]} ${i}<br>${r[0].data[4]}<br>Profit ${r[0].data[1]} %`},axisPointer:{type:"line",label:{backgroundColor:"#6a7985"}}},xAxis:{type:"category",show:!1},yAxis:[{type:"value",name:$,splitLine:{show:!1},nameRotate:90,nameLocation:"middle",nameGap:30}],grid:{...N,left:80},dataZoom:[{type:"inside",start:d,end:100},{bottom:10,start:d,end:100,...F}],visualMap:[{show:!0,seriesIndex:0,pieces:[{max:0,color:g.colorLoss},{min:0,color:g.colorProfit}]}],series:[{type:"bar",name:$,barCategoryGap:"0%",animation:!1,label:{show:!0,position:"top",rotate:90,offset:[7.5,7.5],formatter:"{@[1]} %",color:p.chartTheme==="dark"?"#c2c2c2":"#3c3c3c"},encode:{x:0,y:1},itemStyle:{color:et}}]}});return(d,r)=>b.trades.length>0?(z(),R(f(k),{key:0,option:f(h),autoresize:"",theme:f(p).chartTheme},null,8,["option","theme"])):j("",!0)}}),it=B(ot,[["__scopeId","data-v-a25ff7cc"]]);export{it as _,nt as a};
//# sourceMappingURL=TradesLogChart-CHejX5XD.js.map
