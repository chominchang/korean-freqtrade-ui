import{H as z,c as k,a as c,e as u,Z as Ne,$ as Oe,a0 as ke,a1 as je,N as Fe,d as M,u as N,r as P,j as T,U as ae,b as s,f as e,i as D,h as f,F as S,m as H,z as B,k as b,g as O,x as $,n as W,l as x,a2 as Ee,Y as Q,t as I,K as X,a3 as ye,a4 as Ge,G as E,D as Y,a5 as We,o as oe,y as ge,Q as Ke,W as Ze,s as he,v as Qe,a6 as Ye,a7 as be,w as G,B as xe,I as Xe,a8 as Je,V as et,a9 as tt,X as st}from"./index-B_v6adOj.js";import{_ as at,a as lt,b as ot,c as nt,d as it,s as rt}from"./index-CVMfqBZX.js";import{_ as ne}from"./DraggableContainer.vue_vue_type_script_setup_true_lang-DHspYSQf.js";import{c as Be,i as ct,d as dt}from"./TradeList.vue_vue_type_script_setup_true_lang-DThci9Dd.js";import{_ as $e,a as ut,b as mt,c as we}from"./InfoBox.vue_vue_type_script_setup_true_lang-BoagT56j.js";import{s as ft}from"./index-CzoAdAQz.js";import{_ as pt,s as _t}from"./CandleChartContainer-B70R5nBz.js";import{u as ie,E as re,i as ce,a as de,b as ue,c as me,d as fe}from"./installCanvasRenderer-D8Ld7rAI.js";import{e as Re,i as kt,a as pe,d as bt,b as vt,c as yt,f as Ce,g as Te,h as gt}from"./chartZoom-VPVfHurq.js";import{_ as ht,a as xt}from"./TradesLogChart-CHejX5XD.js";import{s as K,a as Z}from"./index-DgUDcEHW.js";import{g as Ve,a as ve,s as Bt,b as $t}from"./index-BYJZl8H2.js";import{s as wt}from"./index-CGWBOtXF.js";import{_ as Rt}from"./TimeRangeSelect.vue_vue_type_script_setup_true_lang-6P7vX6fe.js";import{s as Ct}from"./index-B9PkDuDZ.js";import{_ as Tt,a as Vt}from"./StrategySelect.vue_vue_type_script_setup_true_lang-7mpt5Uws.js";import{_ as St}from"./check-D6h_suYs.js";import"./index-DZlBha1f.js";import"./index-BqfvO8az.js";import"./plus-box-outline-CSP7u_fJ.js";import"./index-BskzHftK.js";import"./index-B1wKJkPu.js";const Mt={viewBox:"0 0 24 24",width:"1.2em",height:"1.2em"};function At(m,t){return c(),k("svg",Mt,t[0]||(t[0]=[u("path",{fill:"currentColor",d:"M8.59 16.58L13.17 12L8.59 7.41L10 6l6 6l-6 6z"},null,-1)]))}const _e=z({name:"mdi-chevron-right",render:At});var qt=`
.p-radiobutton-group {
    display: inline-flex;
}
`,Pt={root:"p-radiobutton-group p-component"},Lt=Ne.extend({name:"radiobuttongroup",style:qt,classes:Pt}),Dt={name:"BaseRadioButtonGroup",extends:Oe,style:Lt,provide:function(){return{$pcRadioButtonGroup:this,$parentInstance:this}}},Se={name:"RadioButtonGroup",extends:Dt,inheritAttrs:!1,data:function(){return{groupName:this.name}},watch:{name:function(t){this.groupName=t||ke("radiobutton-group-")}},mounted:function(){this.groupName=this.groupName||ke("radiobutton-group-")}};function zt(m,t,o,p,r,l){return c(),k("div",Fe({class:m.cx("root")},m.ptmi("root")),[je(m.$slots,"default")],16)}Se.render=zt;const It={class:"flex justify-center"},Ut=["for"],Ht={class:"divide-y divide-surface-300 dark:divide-surface-700 divide-solid border-x border-y rounded-sm border-surface-300 dark:border-surface-700"},Nt=["title","onClick"],Ot={class:"flex"},jt={class:"flex flex-col"},Ft={key:0},Et={key:0},Gt={class:"px-3 m-0 list-disc list-inside"},Wt={key:0},Kt=M({__name:"TradeListNav",props:{trades:{required:!0,type:Array},backtestMode:{required:!1,default:!1,type:Boolean}},emits:["trade-select"],setup(m,{emit:t}){const o=m,p=t,r=N(),l=P({}),n=P(!0),a=P("openDate"),i=[{text:"Open date",value:"openDate"},{text:"Profit %",value:"profit"}],d=g=>{l.value=g,p("trade-select",g)},y=T(()=>{const g=a.value==="profit"?"profit_ratio":"open_timestamp";return n.value?o.trades.slice().sort((v,w)=>w[g]-v[g]):o.trades.slice().sort((v,w)=>v[g]-w[g])}),_=P(y.value.map(()=>!1));return ae(()=>r.activeBot.selectedPair,()=>{_.value=y.value.map(()=>!1)}),(g,v)=>{const w=ft,V=Se,h=O,A=$e,R=ut,F=mt,J=_e,ee=Ee;return c(),k("div",null,[u("div",It,[v[2]||(v[2]=u("span",{class:"me-2"},"Sort by:",-1)),s(V,{modelValue:e(a),"onUpdate:modelValue":v[0]||(v[0]=C=>D(a)?a.value=C:null),options:i,name:"radio-options"},{default:f(()=>[(c(),k(S,null,H(i,C=>u("div",{key:C.value,class:"flex items-center"},[s(w,{id:`id-${C.value}`,value:C.value},null,8,["id","value"]),u("label",{for:`id-${C.value}`},B(C.text),9,Ut)])),64))]),_:1},8,["modelValue"])]),u("ul",Ht,[s(h,{severity:"secondary",variant:"text",class:"w-full flex flex-wrap justify-center items-center",title:"Trade Navigation",onClick:v[1]||(v[1]=C=>n.value=!e(n))},{default:f(()=>[$("Trade Navigation "+B(e(n)?"↓":"↑"),1)]),_:1}),(c(!0),k(S,null,H(e(y),(C,U)=>(c(),k("li",{key:C.open_timestamp,class:W(["flex flex-col py-1 px-1 items-stretch",{"bg-primary-100 dark:bg-primary-800 text-primary-contrast":C.open_timestamp===e(l).open_timestamp}]),title:`${C.pair}`,onClick:j=>d(C)},[u("div",Ot,[u("div",jt,[u("div",null,[e(r).activeBot.botState.trading_mode!=="spot"?(c(),k("span",Ft,B(C.is_short?"S-":"L-"),1)):b("",!0),s(A,{date:C.open_timestamp},null,8,["date"])]),s(R,{trade:C,class:"my-1"},null,8,["trade"]),m.backtestMode?(c(),x(F,{key:0,"profit-ratio":C.profit_ratio,"stake-currency":e(r).activeBot.stakeCurrency},null,8,["profit-ratio","stake-currency"])):b("",!0)]),s(h,{size:"small",class:"ms-auto mt-auto",variant:"outlined",severity:"secondary",onClick:j=>e(_)[U]=!e(_)[U]},{default:f(()=>[e(_)[U]?b("",!0):(c(),x(J,{key:0,width:"24",height:"24"})),e(_)[U]?(c(),x(ee,{key:1,width:"24",height:"24"})):b("",!0)]),_:2},1032,["onClick"])]),s(Q,null,{default:f(()=>{var j;return[e(_)[U]?(c(),k("div",Et,[u("ul",Gt,[(c(!0),k(S,null,H((j=C.orders)==null?void 0:j.filter(q=>q.order_filled_timestamp!==null),q=>(c(),k("li",{key:q.order_timestamp},B(q.ft_order_side)+" "+B(q.amount)+" at "+B(q.safe_price),1))),128))])])):b("",!0)]}),_:2},1024)],10,Nt))),128)),m.trades.length===0?(c(),k("div",Wt,"No trades to show...")):b("",!0)])])}}}),Zt=I(Kt,[["__scopeId","data-v-8de8cbc0"]]),Qt={viewBox:"0 0 24 24",width:"1.2em",height:"1.2em"};function Yt(m,t){return c(),k("svg",Qt,t[0]||(t[0]=[u("path",{fill:"currentColor",d:"M15.41 16.58L10.83 12l4.58-4.59L14 6l-6 6l6 6z"},null,-1)]))}const Me=z({name:"mdi-chevron-left",render:Yt}),Xt={class:"flex flex-row mb-1 items-center"},Jt={class:"me-2"},es={class:"grow"},ts={class:"text-end"},ss={class:"text-center flex flex-row h-full items-stretch"},as=M({__name:"BacktestResultChart",props:{timeframe:{},strategy:{},freqaiModel:{},timerange:{},backtestResult:{}},setup(m){const t=m,o=N(),p=P({right:!0,left:!0}),r=P(),l=a=>{r.value={startValue:a.open_timestamp,endValue:a.close_timestamp}};function n(a,i){o.activeBot.getPairHistory({pair:a,timeframe:t.timeframe,timerange:t.timerange,strategy:t.strategy,freqaimodel:t.freqaiModel,columns:i})}return(a,i)=>{const d=_e,y=Me,_=O,g=at,v=pt,w=Zt,V=Be,h=ne;return c(),k("div",null,[u("div",Xt,[u("div",Jt,[s(_,{"aria-label":"Close",title:"Pair Navigation",severity:"secondary",variant:"outlined",size:"small",onClick:i[0]||(i[0]=A=>e(p).left=!e(p).left)},{default:f(()=>[e(p).left?b("",!0):(c(),x(d,{key:0,width:"24",height:"24"})),e(p).left?(c(),x(y,{key:1,width:"24",height:"24"})):b("",!0)]),_:1})]),u("span",es,[i[2]||(i[2]=$(" Graph will always show the latest values for the selected strategy. ")),i[3]||(i[3]=u("br",null,null,-1)),$(" Timerange: "+B(a.timerange)+" - "+B(a.strategy),1)]),u("div",ts,[s(_,{"aria-label":"Close",variant:"outlined",title:"Trade Navigation",size:"small",severity:"secondary",onClick:i[1]||(i[1]=A=>e(p).right=!e(p).right)},{default:f(()=>[e(p).right?(c(),x(d,{key:0,width:"24",height:"24"})):b("",!0),e(p).right?b("",!0):(c(),x(y,{key:1,width:"24",height:"24"}))]),_:1})])]),u("div",ss,[s(Q,{name:"fadeleft"},{default:f(()=>[e(p).left?(c(),x(g,{key:0,class:"overflow-y-auto overflow-x-hidden",style:{"max-height":"calc(100vh - 200px)"},pairlist:a.backtestResult.pairlist,trades:a.backtestResult.trades,"starting-balance":a.backtestResult.starting_balance,"sort-method":"profit","backtest-mode":!0},null,8,["pairlist","trades","starting-balance"])):b("",!0)]),_:1}),s(v,{"available-pairs":a.backtestResult.pairlist,"historic-view":!0,timeframe:a.timeframe,timerange:a.timerange,strategy:a.strategy,trades:a.backtestResult.trades,class:"flex-shrink-1 candle-chart-container w-full px-0 h-full align-self-stretch","slider-position":e(r),"freqai-model":a.freqaiModel,onRefreshData:n},null,8,["available-pairs","timeframe","timerange","strategy","trades","slider-position","freqai-model"]),s(Q,{name:"fade"},{default:f(()=>[e(p).right?(c(),x(w,{key:0,class:"overflow-y-auto overflow-x-visible min-w-56",style:{"max-height":"calc(100vh - 200px)"},trades:a.backtestResult.trades.filter(A=>A.pair===e(o).activeBot.selectedPair),onTradeSelect:l},null,8,["trades"])):b("",!0)]),_:1})]),s(h,{header:"Single trades",class:"row mt-2 w-full"},{default:f(()=>[s(V,{class:"row trade-history mt-2 w-full",trades:a.backtestResult.trades,"show-filter":!0},null,8,["trades"])]),_:1})])}}}),ls=I(as,[["__scopeId","data-v-bd17c230"]]);function os(m,t){const o=Math.min(...m),r=(Math.max(...m)-o)*1.01/t,l=[...Array(t).keys()].map(n=>[Math.round((o+n*r)*1e3)/1e3,0]);for(let n=0;n<m.length;n++){const a=Math.min(Math.floor((m[n]-o)/r),t-1);isNaN(a)||l[a][1]++}return l}const ns={class:"flex flex-col h-full relative"},is={class:"grow mb-2"},te="Trade count",rs=M({__name:"ProfitDistributionChart",props:{trades:{required:!0,type:Array},showTitle:{default:!0,type:Boolean}},setup(m){ie([kt,ce,de,pe,ue,me,fe]);const t=m,o=X(),p=[{text:"10",value:10},{text:"15",value:15},{text:"20",value:20},{text:"25",value:25},{text:"50",value:50}],r=T(()=>{const n=t.trades.map(a=>a.profit_ratio);return os(n,o.profitDistributionBins)}),l=T(()=>({title:{text:"Profit distribution",left:"center",show:t.showTitle},backgroundColor:"rgba(0, 0, 0, 0)",dataset:{source:r.value},tooltip:{trigger:"axis",axisPointer:{type:"line",label:{backgroundColor:"#6a7985"}}},legend:{data:[te],right:"5%",selectedMode:!1},xAxis:{type:"category",name:"Profit %",nameLocation:"middle",nameGap:25},yAxis:[{type:"value",name:te,splitLine:{show:!1},nameRotate:90,nameLocation:"middle",nameGap:35,position:"left"}],grid:{...Re,bottom:50},series:[{type:"bar",name:te,animation:!0,encode:{x:"x0",y:"y0"}}]}));return(n,a)=>{const i=ye;return c(),k("div",ns,[u("div",is,[m.trades?(c(),x(e(re),{key:0,option:e(l),autoresize:"",theme:e(o).chartTheme},null,8,["option","theme"])):b("",!0)]),u("div",{class:W(["z-2 absolute fixed-top flex items-center gap-10 ms-2",{"mx-auto":m.showTitle}]),"label-for":"input-bins",size:"sm"},[a[1]||(a[1]=u("label",{for:"input-bins"},"Bins",-1)),s(i,{id:"input-bins",modelValue:e(o).profitDistributionBins,"onUpdate:modelValue":a[0]||(a[0]=d=>e(o).profitDistributionBins=d),size:"small","option-label":"text","option-value":"value",class:"mt-1",options:p},null,8,["modelValue"])],2)])}}}),cs=I(rs,[["__scopeId","data-v-d00350b7"]]),se="Market change %",ds=M({__name:"MarketChangeChart",props:{marketChangeData:{type:Object,required:!0},showTitle:{type:Boolean,default:!0}},setup(m){ie([vt,yt,ce,Ce,de,pe,ue,me,fe,Te]);const t=m,o=X(),p=P(null),r=T(()=>{if(!t.marketChangeData)return{};const l=t.marketChangeData.columns.findIndex(a=>a==="__date_ts"),n=t.marketChangeData.columns.findIndex(a=>a==="rel_mean");return{title:{text:"Market change %",left:"center",show:t.showTitle},backgroundColor:"rgba(0, 0, 0, 0)",dataset:{source:t.marketChangeData.data},tooltip:{trigger:"axis",axisPointer:{type:"line",label:{backgroundColor:"#6a7985"}}},grid:{...Re},legend:{data:[se],right:"5%"},xAxis:[{type:"time",axisLine:{onZero:!1},axisTick:{show:!0},axisLabel:{show:!0},axisPointer:{label:{show:!1}},splitLine:{show:!1},splitNumber:20,min:"dataMin",max:"dataMax"}],yAxis:[{type:"value",name:se,splitLine:{show:!1},nameRotate:90,nameLocation:"middle",nameGap:35}],dataZoom:[{type:"inside",start:0,end:100},{bottom:10,start:0,end:100,...bt}],series:[{type:"line",name:se,showSymbol:!1,color:o.chartTheme==="dark"?"#c2c2c2":"black",encode:{x:l,y:n}}]}});return(l,n)=>{var a;return(a=m.marketChangeData)!=null&&a.data?(c(),x(e(re),{key:0,ref_key:"marketChangeChart",ref:p,option:e(r),theme:e(o).chartTheme,autoresize:""},null,8,["option","theme"])):b("",!0)}}}),us=I(ds,[["__scopeId","data-v-bf4d4981"]]),ms=M({__name:"TradeDurationChart",props:{trades:{},showTitle:{type:Boolean,default:!0}},setup(m){const t=m,o=X();ie([de,me,fe,Ce,ue,pe,ct,dt,ce,Te,gt]);const p=T(()=>t.trades.map(i=>(i.close_timestamp-i.open_timestamp)/(60*1e3))),r=T(()=>t.trades.filter(i=>i.profit_ratio>0).map(i=>(i.close_timestamp-i.open_timestamp)/(60*1e3))),l=T(()=>t.trades.filter(i=>i.profit_ratio<=0).map(i=>(i.close_timestamp-i.open_timestamp)/(60*1e3))),n=T(()=>({title:{text:"Trades durations",left:"center",show:t.showTitle},backgroundColor:"rgba(0, 0, 0, 0)",dataset:[{id:"allTrades",source:[p.value,r.value,l.value]},{id:"allTradesBoxplot",fromDatasetId:"allTrades",transform:{type:"boxplot",config:{itemNameFormatter:i=>{if(i.value===0)return"All trades";if(i.value===1)return"Winning trades";if(i.value===2)return"Losing trades"}}}},{id:"outlier",fromDatasetIndex:1,fromTransformResult:1}],xAxis:{type:"category",show:!0},yAxis:[{type:"value",name:"Trade duration",splitArea:{show:!0},axisLabel:{formatter:a}}],tooltip:{formatter:i=>{if(i.seriesType==="boxplot"){const d=i.data;return`
            <div>${i.name}</div>
            <div>Min: ${a(d[1])}</div>
            <div>Q1: ${a(d[2])}</div>
            <div>Median: ${a(d[3])}</div>
            <div>Q3: ${a(d[4])}</div>
            <div>Max: ${a(d[5])}</div>
          `}return""}},visualMap:[{type:"piecewise",show:!1,dimension:0,pieces:[{min:0,max:0,label:"All Trades",color:"#5470c6"},{min:1,max:1,label:"Winning Trades",color:"#91cc75"},{min:2,max:2,label:"Losing Trades",color:"#fc8452"}]}],series:[{name:"Trade durations",type:"boxplot",datasetId:"allTradesBoxplot",colorBy:"data"},{name:"outlier",type:"scatter",datasetId:"outlier"}]}));function a(i){if(i>=60){const d=Math.floor(i/60),y=Math.floor(i%60);return`${d}h ${y}m`}return`${Math.floor(i)}m`}return(i,d)=>i.trades.length>0?(c(),x(e(re),{key:0,option:e(n),autoresize:"",theme:e(o).chartTheme},null,8,["option","theme"])):b("",!0)}}),fs=I(ms,[["__scopeId","data-v-27bd9a08"]]),ps={class:"text-center flex-fill flex flex-col h-full gap-1"},_s=M({__name:"BacktestGraphs",props:{trades:{required:!0,type:Array}},setup(m){const t=N(),{state:o}=Ge(()=>t.activeBot.getBacktestMarketChange(),null);return(p,r)=>{const l=ht,n=xt,a=us,i=cs;return c(),k("div",ps,[s(l,{trades:m.trades,class:"flex-grow-1 chart-equal-height"},null,8,["trades"]),s(fs,{class:"flex-grow-1 chart-equal-height",trades:m.trades,"show-title":!0},null,8,["trades"]),s(n,{trades:m.trades,class:"flex-grow-1 chart-equal-height","show-title":!0},null,8,["trades"]),e(o)?(c(),x(a,{key:0,"market-change-data":e(o),class:"flex-grow-1 chart-equal-height"},null,8,["market-change-data"])):b("",!0),s(i,{class:"flex-grow-1 chart-equal-height",trades:m.trades,"show-title":!0},null,8,["trades"])])}}}),ks=I(_s,[["__scopeId","data-v-178197b6"]]),bs={class:"flex flex-col me-2 text-start"},vs={class:"font-bold"},ys={class:"text-sm"},gs={key:0,class:"text-sm",style:{"white-space":"pre-wrap"}},Ae=M({__name:"BacktestResultSelectEntry",props:{backtestResult:{required:!0,type:Object},selectedBacktestResultKey:{required:!1,default:"",type:String},canUseModify:{required:!1,default:!1,type:Boolean}},setup(m){return(t,o)=>(c(),k("div",bs,[u("div",vs,B(m.backtestResult.metadata.strategyName)+" - "+B(m.backtestResult.strategy.timeframe),1),u("div",ys," TradeCount: "+B(m.backtestResult.strategy.total_trades)+" - Profit: "+B(("formatPercent"in t?t.formatPercent:e(E))(m.backtestResult.strategy.profit_total)),1),m.canUseModify?(c(),k("div",gs,B(m.backtestResult.metadata.notes),1)):b("",!0)]))}});function le(m,t){return Object.entries(m).reduce((p,[r,l])=>(l.forEach(n=>{const[a,i]=Object.entries(n)[0],d=p.find(y=>y[t]===a);d?d[r]=i:p.push({[t]:a,[r]:i})}),p),[])}const hs={class:"px-0 mw-full"},xs={class:"flex flex-col text-start ms-0 me-2 gap-2"},Bs={class:"flex flex-col flex-xl-row"},$s={class:"px-0 xl:px-0 pt-2 xl:pt-0 xl:ps-1 flex-fill"},ws={key:1},Rs=M({__name:"BacktestResultComparison",props:{backtestResults:{required:!0,type:Object}},setup(m){const t=m,o=T(()=>{const r={};return Object.entries(t.backtestResults).forEach(([l,n])=>{const a=Ve(n.strategy);r[l]=a}),console.log(r),le(r,"metric")}),p=T(()=>{const r=[{key:"metric",label:"Metric"}];return Object.entries(t.backtestResults).forEach(([l,n])=>{r.push({key:l,label:n.metadata.strategyName})}),r});return(r,l)=>{const n=Ae,a=Z,i=K;return c(),k("div",hs,[l[0]||(l[0]=u("div",{class:"flex justify-center"},[u("h3",{class:"font-bold text-3xl"},"Backtest-result comparison")],-1)),u("div",xs,[u("div",Bs,[u("div",$s,[s(i,{bordered:"",value:e(o),size:"small","show-gridlines":""},{default:f(()=>[(c(!0),k(S,null,H(e(p),d=>(c(),x(a,{key:d.key,field:d.key,label:d.label},{header:f(()=>[d.key&&d.key in m.backtestResults?(c(),x(n,{key:0,"backtest-result":m.backtestResults[d.key]},null,8,["backtest-result"])):(c(),k("span",ws,B(d.label),1))]),_:2},1032,["field","label"]))),128))]),_:1},8,["value"])])])])])}}}),Cs=M({__name:"BacktestResultPeriodBreakdown",props:{periodicBreakdown:{}},setup(m){const t=m,o=T(()=>{const r=[{value:"day",text:"Days"},{value:"week",text:"Weeks"},{value:"month",text:"Months"}];return t.periodicBreakdown.year&&r.push({value:"year",text:"Years"}),r}),p=P("month");return(r,l)=>{const n=wt,a=Z,i=K;return c(),k(S,null,[s(n,{modelValue:e(p),"onUpdate:modelValue":l[0]||(l[0]=d=>D(p)?p.value=d:null),options:e(o),size:"small","allow-empty":!1,class:"m-2","option-label":"text","option-value":"value"},null,8,["modelValue","options"]),s(i,{size:"small",stacked:"sm",value:r.periodicBreakdown[e(p)]},{default:f(()=>[s(a,{field:"date",header:"Date"}),s(a,{field:"trades",header:"Trades"},{body:f(({data:d,field:y})=>[$(B(d[y]??"N/A"),1)]),_:1}),s(a,{field:"profit_abs",header:"Total Profit",body:"formatPrice"in r?r.formatPrice:e(Y)},{body:f(({data:d,field:y})=>[$(B(d[y]?d[y].toFixed(2):"N/A"),1)]),_:1},8,["body"]),s(a,{field:"profit_factor",header:"Profit Factor"},{body:f(({data:d,field:y})=>[$(B(("formatPrice"in r?r.formatPrice:e(Y))(d[y],2)),1)]),_:1}),s(a,{field:"wins",header:"Wins"}),s(a,{field:"draws",header:"Draws"}),s(a,{field:"losses",header:"Losses"},{body:f(({data:d})=>[$(B(d.loses??d.losses??"N/A"),1)]),_:1}),s(a,{field:"wins",header:"Win Rate"},{body:f(({data:d})=>[$(B((d.wins/(d.wins+d.draws+(d.loses??d.losses))*100).toFixed(2)+"%"),1)]),_:1})]),_:1},8,["value"])],64)}}}),Ts={class:"flex flex-row w-full justify-between items-center"},Vs=M({__name:"BacktestResultTablePer",props:{title:{},results:{},stakeCurrency:{},stakeCurrencyDecimals:{},keyHeader:{default:""},keyHeaders:{default:()=>[]}},setup(m){const t=m,o=T(()=>t.results.map(n=>t.keyHeaders.length>0?{...n,key:typeof n.key=="string"?Array(t.keyHeaders.length).fill(n.key):n.key}:n)),p=T(()=>{const n=[];if(t.keyHeaders.length>0)for(let a=0;a<t.keyHeaders.length;a+=1)n.push({key:`key[${a}]`,label:t.keyHeaders[a],formatter:(i,d)=>Array.isArray(i)?i[a]:i||d.exit_reason||"OTHER"});else n.push({key:"key",label:t.keyHeader,formatter:(a,i)=>a||i.exit_reason||"OTHER"});return n}),r=X(),l=T(()=>ve.value.filter(n=>n.field!=="key"&&r.backtestAdditionalMetrics.includes(n.field)));return(n,a)=>{const i=Bt,d=Z,y=K,_=ne;return c(),x(_,null,{header:f(()=>[u("div",Ts,[$(B(n.title)+" ",1),u("div",null,[a[1]||(a[1]=$(" Shown metrics: ")),s(i,{id:"backtestMetrics",modelValue:e(r).backtestAdditionalMetrics,"onUpdate:modelValue":a[0]||(a[0]=g=>e(r).backtestAdditionalMetrics=g),options:"availableBacktestMetrics"in n?n.availableBacktestMetrics:e(ve),"option-label":"header","option-value":"field",size:"small"},null,8,["modelValue","options"])])])]),default:f(()=>[s(y,{size:"small",hover:"",stacked:"sm",value:e(o)},{default:f(()=>[(c(!0),k(S,null,H(e(p),g=>(c(),x(d,{key:g.key,field:g.key,header:g.label},{body:f(({data:v})=>[$(B(g.formatter(v.key,v)),1)]),_:2},1032,["field","header"]))),128)),s(d,{field:"trades",header:"Trades"}),s(d,{field:"profit_mean",header:"Avg Profit %"},{body:f(({data:g,field:v})=>[$(B(("formatPercent"in n?n.formatPercent:e(E))(g[v],2)),1)]),_:1}),s(d,{field:"profit_total_abs",header:`Tot Profit ${t.stakeCurrency}`},{body:f(({data:g,field:v})=>[$(B(("formatPrice"in n?n.formatPrice:e(Y))(g[v],t.stakeCurrencyDecimals)),1)]),_:1},8,["header"]),s(d,{field:"profit_total",header:"Tot Profit %"},{body:f(({data:g,field:v})=>[$(B(("formatPercent"in n?n.formatPercent:e(E))(g[v],2)),1)]),_:1}),s(d,{field:"wins",header:"Wins"}),s(d,{field:"draws",header:"Draws"}),s(d,{field:"losses",header:"Losses"}),(c(!0),k(S,null,H(e(l),g=>(c(),x(d,{key:g.field,field:g.field,header:g.header},{body:f(({data:v,field:w})=>[$(B(g.is_ratio?("formatPercent"in n?n.formatPercent:e(E))(v[w],2):("formatPrice"in n?n.formatPrice:e(Y))(v[w],2)),1)]),_:2},1032,["field","header"]))),128))]),_:1},8,["value"])]),_:1})}}}),Ss={class:"px-0 w-full"},Ms={class:"flex justify-center"},As={class:"font-bold text-2xl mb-2"},qs={class:"flex flex-col text-start ms-0 me-2 gap-2"},Ps={class:"flex flex-col xl:flex-row"},Ls={class:"px-0 px-xl-0 pe-xl-1 grow"},Ds={class:"px-0 xl:px-0 pt-2 xl:pt-0 xl:ps-1 grow"},zs=M({__name:"BacktestResultAnalysis",props:{backtestResult:{}},setup(m){const t=m,o=T(()=>{const r=Ve(t.backtestResult);return le({value:r},"metric")}),p=T(()=>{const r=$t(t.backtestResult);return le({value:r},"setting")});return(r,l)=>{const n=Z,a=K,i=ne,d=Vs,y=Cs,_=Be;return c(),k("div",Ss,[u("div",Ms,[u("h3",As," Backtest-result for "+B(r.backtestResult.strategy_name),1)]),u("div",qs,[u("div",Ps,[u("div",Ls,[s(i,{header:"Strategy settings"},{default:f(()=>[s(a,{size:"small",value:e(p)},{default:f(()=>[s(n,{field:"setting",header:"Setting"}),s(n,{field:"value",header:"Value"})]),_:1},8,["value"])]),_:1})]),u("div",Ds,[s(i,{header:"Metrics"},{default:f(()=>[s(a,{size:"small",borderless:"",value:e(o)},{default:f(()=>[s(n,{field:"metric",header:"Metric"}),s(n,{field:"value",header:"Value"})]),_:1},8,["value"])]),_:1})])]),s(d,{title:"Results per Enter tag",results:r.backtestResult.results_per_enter_tag,"stake-currency":r.backtestResult.stake_currency,"key-header":"Enter Tag","stake-currency-decimals":r.backtestResult.stake_currency_decimals},null,8,["results","stake-currency","stake-currency-decimals"]),s(d,{title:"Results per Exit reason",results:r.backtestResult.exit_reason_summary??[],"stake-currency":r.backtestResult.stake_currency,"key-header":"Exit Reason","stake-currency-decimals":r.backtestResult.stake_currency_decimals},null,8,["results","stake-currency","stake-currency-decimals"]),r.backtestResult.mix_tag_stats?(c(),x(d,{key:0,title:"Results Mixed Tag",results:r.backtestResult.mix_tag_stats??[],"stake-currency":r.backtestResult.stake_currency,"key-headers":["Enter Tag","Exit Tag"],"stake-currency-decimals":r.backtestResult.stake_currency_decimals},null,8,["results","stake-currency","stake-currency-decimals"])):b("",!0),s(d,{title:"Results per pair",results:r.backtestResult.results_per_pair,"stake-currency":r.backtestResult.stake_currency,"key-header":"Pair","stake-currency-decimals":r.backtestResult.stake_currency_decimals},null,8,["results","stake-currency","stake-currency-decimals"]),r.backtestResult.periodic_breakdown?(c(),x(i,{key:1,header:"Periodic breakdown"},{default:f(()=>[s(y,{"periodic-breakdown":r.backtestResult.periodic_breakdown},null,8,["periodic-breakdown"])]),_:1})):b("",!0),s(i,{header:"Single trades"},{default:f(()=>[s(_,{trades:r.backtestResult.trades,"show-filter":!0,"stake-currency":r.backtestResult.stake_currency},null,8,["trades","stake-currency"])]),_:1})])])}}}),Is={class:"w-full flex"},Us={class:"ms-2"},Hs=M({__name:"FreqaiModelSelect",props:{modelValue:{},modelModifiers:{}},emits:["update:modelValue"],setup(m){const t=We(m,"modelValue"),o=N();return oe(()=>{o.activeBot.freqaiModelList.length===0&&o.activeBot.getFreqAIModelList()}),(p,r)=>{const l=ye,n=ge,a=O;return c(),k("div",null,[u("div",Is,[s(l,{modelValue:t.value,"onUpdate:modelValue":r[0]||(r[0]=i=>t.value=i),options:e(o).activeBot.freqaiModelList,fluid:"",size:"small"},null,8,["modelValue","options"]),u("div",Us,[s(a,{severity:"secondary",variant:"outlined",size:"small",onClick:e(o).activeBot.getFreqAIModelList},{icon:f(()=>[s(n)]),_:1},8,["onClick"])])])])}}}),qe=Ke("btStore",{state:()=>({strategy:"",selectedTimeframe:"",selectedDetailTimeframe:"",timerange:"",maxOpenTrades:null,stakeAmount:null,startingCapital:null,allowCache:!0,enableProtections:!1,stakeAmountUnlimited:!1,freqAI:{enabled:!1,model:"",identifier:""}}),getters:{canRunBacktest:m=>m.strategy!==""},actions:{}}),Ns={class:"mb-2"},Os=["disabled"],js={for:"timeframe-detail-select",class:"flex justify-end items-center gap-2"},Fs={class:"flex items-center"},Es={class:"flex basis-full"},Gs={class:"flex justify-end items-center"},Ws={class:"flex flex-wrap md:flex-nowrap justify-between md:justify-center"},Ks=M({__name:"BacktestRun",setup(m){const t=N(),o=qe();function p(){const r={strategy:o.strategy,timerange:o.timerange,enable_protections:o.enableProtections};if(o.maxOpenTrades&&(r.max_open_trades=o.maxOpenTrades),o.stakeAmountUnlimited)r.stake_amount="unlimited";else{const n=Number(o.stakeAmount);n&&(r.stake_amount=n.toString())}const l=Number(o.startingCapital);l&&(r.dry_run_wallet=l),o.selectedTimeframe&&(r.timeframe=o.selectedTimeframe),o.selectedDetailTimeframe&&(r.timeframe_detail=o.selectedDetailTimeframe),o.allowCache||(r.backtest_cache="none"),o.freqAI.enabled&&(r.freqaimodel=o.freqAI.model,o.freqAI.identifier!==""&&(r.freqai={identifier:o.freqAI.identifier})),t.activeBot.startBacktest(r)}return(r,l)=>{const n=Tt,a=Vt,i=we,d=Ct,y=Ze,_=he,g=Hs,v=Qe,w=Rt,V=O;return c(),k(S,null,[u("div",Ns,[l[13]||(l[13]=u("span",null,"Strategy",-1)),s(n,{modelValue:e(o).strategy,"onUpdate:modelValue":l[0]||(l[0]=h=>e(o).strategy=h)},null,8,["modelValue"])]),u("div",{class:"grid grid-cols-2 border border-surface-500 rounded-sm gap-y-2 gap-2 items-center p-1 pt-3",disabled:e(t).activeBot.backtestRunning},[l[20]||(l[20]=u("h3",{class:"font-bold mb-2 col-span-2 text-center"},"Backtesting parameters",-1)),l[21]||(l[21]=u("label",{for:"timeframe-select"},"Timeframe:",-1)),s(a,{id:"timeframe-select",modelValue:e(o).selectedTimeframe,"onUpdate:modelValue":l[1]||(l[1]=h=>e(o).selectedTimeframe=h),size:"small"},null,8,["modelValue"]),u("label",js,[l[14]||(l[14]=$("Detail Timeframe: ")),s(i,{hint:"Detail timeframe, to simulate intra-candle results. Not setting this will not use this functionality."})]),s(a,{id:"timeframe-detail-select",modelValue:e(o).selectedDetailTimeframe,"onUpdate:modelValue":l[2]||(l[2]=h=>e(o).selectedDetailTimeframe=h),size:"small","below-timeframe":e(o).selectedTimeframe},null,8,["modelValue","below-timeframe"]),l[22]||(l[22]=u("label",{for:"max-open-trades"},"Max open trades:",-1)),s(d,{id:"max-open-trades",modelValue:e(o).maxOpenTrades,"onUpdate:modelValue":l[3]||(l[3]=h=>e(o).maxOpenTrades=h),size:"small",placeholder:"Use strategy default",type:"number"},null,8,["modelValue"]),l[23]||(l[23]=u("label",{for:"starting-capital"},"Starting capital:",-1)),s(d,{id:"starting-capital",modelValue:e(o).startingCapital,"onUpdate:modelValue":l[4]||(l[4]=h=>e(o).startingCapital=h),size:"small",placeholder:"Use config default",type:"number",step:.001},null,8,["modelValue"]),l[24]||(l[24]=u("label",{for:"stake-amount-bool"},"Stake amount:",-1)),u("div",Fs,[u("div",Es,[s(y,{id:"stake-amount-bool",modelValue:e(o).stakeAmountUnlimited,"onUpdate:modelValue":l[5]||(l[5]=h=>e(o).stakeAmountUnlimited=h)},{default:f(()=>l[15]||(l[15]=[$("Unlimited stake")])),_:1},8,["modelValue"])]),s(d,{id:"stake-amount",modelValue:e(o).stakeAmount,"onUpdate:modelValue":l[6]||(l[6]=h=>e(o).stakeAmount=h),placeholder:"Use strategy default",step:.01,size:"small",disabled:e(o).stakeAmountUnlimited},null,8,["modelValue","disabled"])]),l[25]||(l[25]=u("label",{for:"enable-protections"},"Enable Protections:",-1)),s(y,{id:"enable-protections",modelValue:e(o).enableProtections,"onUpdate:modelValue":l[7]||(l[7]=h=>e(o).enableProtections=h)},null,8,["modelValue"]),e(t).activeBot.botApiVersion>=2.22?(c(),k(S,{key:0},[l[16]||(l[16]=u("label",{for:"enable-cache"},"Cache Backtest results:",-1)),s(y,{id:"enable-cache",modelValue:e(o).allowCache,"onUpdate:modelValue":l[8]||(l[8]=h=>e(o).allowCache=h)},null,8,["modelValue"])],64)):b("",!0),e(t).activeBot.botApiVersion>=2.22?(c(),k(S,{key:1},[u("div",Gs,[l[17]||(l[17]=u("span",{class:"me-2"},"Enable FreqAI:",-1)),s(i,{hint:"Assumes freqAI configuration is setup in the configuration, and the strategy is a freqAI strategy. Will fail if that's not the case."})]),s(y,{id:"enable-freqai",modelValue:e(o).freqAI.enabled,"onUpdate:modelValue":l[9]||(l[9]=h=>e(o).freqAI.enabled=h)},null,8,["modelValue"]),e(o).freqAI.enabled?(c(),k(S,{key:0},[l[18]||(l[18]=u("label",{for:"freqai-identifier"},"FreqAI identifier:",-1)),s(_,{id:"freqai-identifier",modelValue:e(o).freqAI.identifier,"onUpdate:modelValue":l[10]||(l[10]=h=>e(o).freqAI.identifier=h),placeholder:"Use config default",size:"small"},null,8,["modelValue"])],64)):b("",!0),e(o).freqAI.enabled?(c(),k(S,{key:1},[l[19]||(l[19]=u("label",{for:"freqai-model"},"FreqAI Model:",-1)),s(g,{id:"freqai-model",modelValue:e(o).freqAI.model,"onUpdate:modelValue":l[11]||(l[11]=h=>e(o).freqAI.model=h)},null,8,["modelValue"])],64)):b("",!0)],64)):b("",!0),s(v,{class:"col-span-2"}),s(w,{modelValue:e(o).timerange,"onUpdate:modelValue":l[12]||(l[12]=h=>e(o).timerange=h),class:"mx-auto mt-2 col-span-2"},null,8,["modelValue"])],8,Os),l[30]||(l[30]=u("h3",{class:"mt-3 font-bold text-2xl"},"Backtesting summary",-1)),u("div",Ws,[s(V,{id:"start-backtest",severity:"primary",disabled:!e(o).canRunBacktest||e(t).activeBot.backtestRunning||!e(t).activeBot.canRunBacktest,class:"mx-1",onClick:p},{default:f(()=>l[26]||(l[26]=[$(" Start backtest ")])),_:1},8,["disabled"]),s(V,{severity:"secondary",disabled:e(t).activeBot.backtestRunning||!e(t).activeBot.canRunBacktest,class:"mx-1",onClick:e(t).activeBot.pollBacktest},{default:f(()=>l[27]||(l[27]=[$(" Load backtest result ")])),_:1},8,["disabled","onClick"]),s(V,{severity:"secondary",class:"mx-1",disabled:!e(t).activeBot.backtestRunning,onClick:e(t).activeBot.stopBacktest},{default:f(()=>l[28]||(l[28]=[$(" Stop Backtest ")])),_:1},8,["disabled","onClick"]),s(V,{severity:"secondary",class:"mx-1",disabled:e(t).activeBot.backtestRunning||!e(t).activeBot.canRunBacktest,onClick:e(t).activeBot.removeBacktest},{default:f(()=>l[29]||(l[29]=[$(" Reset Backtest ")])),_:1},8,["disabled","onClick"])])],64)}}}),Zs=I(Ks,[["__scopeId","data-v-024fb3f9"]]),Qs={viewBox:"0 0 24 24",width:"1.2em",height:"1.2em"};function Ys(m,t){return c(),k("svg",Qs,t[0]||(t[0]=[u("path",{fill:"currentColor",d:"M4 11v2h12l-5.5 5.5l1.42 1.42L19.84 12l-7.92-7.92L10.5 5.5L16 11z"},null,-1)]))}const Xs=z({name:"mdi-arrow-right",render:Ys}),Js={key:0,class:"flex align-center"},ea={key:0,class:"ms-1"},ta={class:"flex items-center"},sa=M({__name:"BacktestHistoryLoad",setup(m){const t=N(),o=P(),p=P(""),r=Ye(p,350,{maxWait:1e3});oe(()=>{t.activeBot.getBacktestHistory()});function l(i){var y;const d={title:"Delete result",message:`Delete result ${i.filename} from disk?`,accept:()=>{t.activeBot.deleteBacktestHistoryResult(i)}};(y=o.value)==null||y.show(d)}const n=T(()=>t.activeBot.backtestHistoryList.filter(i=>i.filename.toLowerCase().includes(r.value.toLowerCase())||i.strategy.toLowerCase().includes(r.value.toLowerCase())));function a(i){t.activeBot.getBacktestHistoryResult(i.data)}return(i,d)=>{const y=ge,_=O,g=he,v=Z,w=$e,V=Xs,h=xe,A=K;return c(),k(S,null,[u("div",null,[s(_,{class:"float-end",title:"Refresh","aria-label":"Refresh",variant:"outlined",severity:"secondary",onClick:e(t).activeBot.getBacktestHistory},{default:f(()=>[s(y)]),_:1},8,["onClick"]),d[1]||(d[1]=u("p",null," Load Historic results from disk. You can click on multiple results to load all of them into freqUI. ",-1)),e(t).activeBot.backtestHistoryList.length>0?(c(),k("div",Js,[s(g,{id:"trade-filter",modelValue:e(p),"onUpdate:modelValue":d[0]||(d[0]=R=>D(p)?p.value=R:null),type:"text",size:"small",placeholder:"Filter results",title:"Filter results"},null,8,["modelValue"])])):b("",!0),e(t).activeBot.backtestHistoryList.length>0?(c(),x(A,{key:1,class:"mt-2",responsive:"",size:"small",scrollable:"","scroll-height":"50rem","virtual-scroller-options":{itemSize:46},"show-gridlines":"",value:e(n),onRowClick:a},{default:f(()=>[s(v,{field:"strategy",header:"Strategy2"}),s(v,{field:"timeframe",header:"Details"},{body:f(({data:R})=>[u("strong",null,B(R.timeframe),1),R.backtest_start_ts&&R.backtest_end_ts?(c(),k("span",ea,B(("timestampToTimeRangeString"in i?i.timestampToTimeRangeString:e(be))(R.backtest_start_ts*1e3))+"-"+B(("timestampToTimeRangeString"in i?i.timestampToTimeRangeString:e(be))(R.backtest_end_ts*1e3)),1)):b("",!0)]),_:1}),s(v,{field:"backtest_start_time",header:"Backtest Time"},{body:f(({data:R})=>[s(w,{date:R.backtest_start_time*1e3},null,8,["date"])]),_:1}),s(v,{field:"filename",header:"Filename"}),s(v,{field:"actions",header:"Actions"},{body:f(({data:R})=>[u("div",ta,[e(t).activeBot.botApiVersion>=2.32?(c(),x(we,{key:0,class:W(R.notes?"opacity-100":"opacity-0"),hint:R.notes??""},null,8,["class","hint"])):b("",!0),e(t).activeBot.botApiVersion>=2.31?(c(),x(_,{key:1,class:"ms-1",size:"small",title:"Load this Result.",disabled:R.run_id in e(t).activeBot.backtestHistory,onClick:G(F=>e(t).activeBot.getBacktestHistoryResult(R),["stop"])},{icon:f(()=>[s(V)]),_:2},1032,["disabled","onClick"])):b("",!0),e(t).activeBot.botApiVersion>=2.31?(c(),x(_,{key:2,class:"ms-1",size:"small",severity:"secondary",title:"Delete this Result.",disabled:R.run_id in e(t).activeBot.backtestHistory,onClick:G(F=>l(R),["stop"])},{icon:f(()=>[s(h)]),_:2},1032,["disabled","onClick"])):b("",!0)])]),_:1})]),_:1},8,["value"])):b("",!0)]),s(Xe,{ref_key:"msgBox",ref:o},null,512)],64)}}}),aa={viewBox:"0 0 24 24",width:"1.2em",height:"1.2em"};function la(m,t){return c(),k("svg",aa,t[0]||(t[0]=[u("path",{fill:"currentColor",d:"M21 8c-1.5 0-2.3 1.4-1.9 2.5l-3.6 3.6c-.3-.1-.7-.1-1 0l-2.6-2.6c.4-1.1-.4-2.5-1.9-2.5c-1.4 0-2.3 1.4-1.9 2.5L3.5 16c-1.1-.3-2.5.5-2.5 2c0 1.1.9 2 2 2c1.4 0 2.3-1.4 1.9-2.5l4.5-4.6c.3.1.7.1 1 0l2.6 2.6c-.3 1 .5 2.5 2 2.5s2.3-1.4 1.9-2.5l3.6-3.6c1.1.3 2.5-.5 2.5-1.9c0-1.1-.9-2-2-2m-6 1l.9-2.1L18 6l-2.1-.9L15 3l-.9 2.1L12 6l2.1.9zM3.5 11L4 9l2-.5L4 8l-.5-2L3 8l-2 .5L3 9z"},null,-1)]))}const oa=z({name:"mdi-chart-timeline-variant-shimmer",render:la}),na={viewBox:"0 0 24 24",width:"1.2em",height:"1.2em"};function ia(m,t){return c(),k("svg",na,t[0]||(t[0]=[u("path",{fill:"currentColor",d:"M4 19v1h18v2H2V2h2v15c3 0 6-2 8.1-5.6c3-5 6.3-7.4 9.9-7.4v2c-2.8 0-5.5 2.1-8.1 6.5C11.3 16.6 7.7 19 4 19"},null,-1)]))}const ra=z({name:"mdi-chart-bell-curve-cumulative",render:ia}),ca={viewBox:"0 0 24 24",width:"1.2em",height:"1.2em"};function da(m,t){return c(),k("svg",ca,t[0]||(t[0]=[u("path",{fill:"currentColor",d:"M9 14H2v2h7v3l4-4l-4-4zm6-1v-3h7V8h-7V5l-4 4z"},null,-1)]))}const ua=z({name:"mdi-compare-horizontal",render:da}),ma={viewBox:"0 0 24 24",width:"1.2em",height:"1.2em"};function fa(m,t){return c(),k("svg",ma,t[0]||(t[0]=[u("path",{fill:"currentColor",d:"M17 16.88c.56 0 1 .44 1 1s-.44 1-1 1s-1-.45-1-1s.44-1 1-1m0-3c2.73 0 5.06 1.66 6 4c-.94 2.34-3.27 4-6 4s-5.06-1.66-6-4c.94-2.34 3.27-4 6-4m0 1.5a2.5 2.5 0 0 0 0 5a2.5 2.5 0 0 0 0-5M18 3H4c-1.1 0-2 .9-2 2v12c0 1.1.9 2 2 2h5.42c-.16-.32-.3-.66-.42-1c.12-.34.26-.68.42-1H4v-4h6v2.97c.55-.86 1.23-1.6 2-2.21V13h1.15c1.16-.64 2.47-1 3.85-1c1.06 0 2.07.21 3 .59V5c0-1.1-.9-2-2-2m-8 8H4V7h6zm8 0h-6V7h6z"},null,-1)]))}const pa=z({name:"mdi-table-eye",render:fa}),_a={viewBox:"0 0 24 24",width:"1.2em",height:"1.2em"};function ka(m,t){return c(),k("svg",_a,t[0]||(t[0]=[u("path",{fill:"currentColor",d:"M6.5 20q-2.28 0-3.89-1.57Q1 16.85 1 14.58q0-1.95 1.17-3.48q1.18-1.53 3.08-1.95q.58-2.02 2.14-3.4Q8.95 4.38 11 4.08v8.07L9.4 10.6L8 12l4 4l4-4l-1.4-1.4l-1.6 1.55V4.08q2.58.35 4.29 2.31T19 11q1.73.2 2.86 1.5q1.14 1.28 1.14 3q0 1.88-1.31 3.19T18.5 20Z"},null,-1)]))}const ba=z({name:"mdi-cloud-download",render:ka}),va={class:"flex flex-col items-stretch"},ya={class:"ms-2 divide-y border-x border-surface-500 rounded-sm border-y divide-solid divide-surface-500"},ga=["onClick"],ha={class:"flex"},xa=M({__name:"BacktestResultSelect",props:{backtestHistory:{required:!0,type:Object},selectedBacktestResultKey:{required:!1,default:"",type:String},canUseModify:{required:!1,default:!1,type:Boolean}},emits:["selectionChange","removeResult","updateResult"],setup(m,{emit:t}){const o=t,p=l=>{o("selectionChange",l)};function r(l,n){n.metadata.editing=!n.metadata.editing,n.metadata.filename&&o("updateResult",{run_id:l,notes:n.metadata.notes??"",filename:n.metadata.filename,strategy:n.metadata.strategyName})}return(l,n)=>{const a=Ae,i=Je,d=O,y=xe,_=_t,g=St;return c(),k("div",va,[n[0]||(n[0]=u("h3",{class:"font-bold text-2xl"},"Available results:",-1)),u("ul",ya,[(c(!0),k(S,null,H(Object.entries(m.backtestHistory),([v,w])=>(c(),k("li",{key:v,button:"",class:W([{"bg-primary dark:border-primary text-primary-contrast":v===m.selectedBacktestResultKey},"flex justify-between items-center py-1 px-1"]),onClick:V=>p(v)},[w.metadata.editing?b("",!0):(c(),k(S,{key:0},[s(a,{"backtest-result":w,"can-use-modify":m.canUseModify},null,8,["backtest-result","can-use-modify"]),u("div",ha,[m.canUseModify?(c(),x(d,{key:0,class:"flex-nowrap",size:"small",severity:"secondary",title:"Modify result notes.",onClick:G(V=>w.metadata.editing=!w.metadata.editing,["stop"])},{icon:f(()=>[s(i)]),_:2},1032,["onClick"])):b("",!0),s(d,{size:"small",class:"flex-nowrap",severity:"secondary",title:"Delete this Result from UI.",onClick:G(V=>o("removeResult",v),["stop"])},{icon:f(()=>[s(y)]),_:2},1032,["onClick"])])],64)),w.metadata.editing?(c(),k(S,{key:1},[s(_,{modelValue:w.metadata.notes,"onUpdate:modelValue":V=>w.metadata.notes=V,placeholder:"notes",size:"small"},null,8,["modelValue","onUpdate:modelValue"]),s(d,{size:"small",title:"Confirm",onClick:G(V=>r(v,w),["stop"])},{icon:f(()=>[s(g)]),_:2},1032,["onClick"])],64)):b("",!0)],10,ga))),128))])])}}}),Ba={class:"flex flex-row pt-1 me-1 relative",style:{height:"calc(100vh - 60px)"}},$a={key:0,class:"me-3 flex flex-col fixed",style:{"max-height":"calc(100vh - 60px)"}},wa={class:"flex flex-col w-full"},Ra={key:0},Ca={class:"w-full"},Ta=M({__name:"BacktestingView",setup(m){const t=N(),o=qe(),p=T(()=>t.activeBot.backtestHistory?Object.keys(t.activeBot.backtestHistory).length!==0:!1),r=T(()=>t.activeBot.backtestHistory?Object.keys(t.activeBot.backtestHistory).length>1:!1),l=T(()=>{try{return t.activeBot.selectedBacktestResult.timeframe}catch{return""}}),n=P(!1),a=P("run"),i=P(null),d=()=>{o.strategy=t.activeBot.selectedBacktestResult.strategy_name,t.activeBot.getStrategy(o.strategy),o.selectedTimeframe=t.activeBot.selectedBacktestResult.timeframe,o.selectedDetailTimeframe=t.activeBot.selectedBacktestResult.timeframe_detail||"",o.timerange=t.activeBot.selectedBacktestResult.timerange};return ae(()=>t.activeBot.selectedBacktestResultKey,()=>{d()}),oe(()=>t.activeBot.getState()),ae(()=>t.activeBot.backtestRunning,()=>{t.activeBot.backtestRunning===!0?i.value=window.setInterval(t.activeBot.pollBacktest,1e3):i.value&&(clearInterval(i.value),i.value=null)}),(y,_)=>{const g=_e,v=Me,w=O,V=xa,h=ba,A=ot,R=tt,F=pa,J=ua,ee=ra,C=oa,U=lt,j=sa,q=it,Pe=Zs,Le=zs,De=Rs,ze=ks,Ie=ls,Ue=nt,He=rt;return c(),k("div",Ba,[u("div",{class:W(["flex md:flex-row h-full w-16",{"w-96!":e(n)}])},[e(a)!=="visualize"?(c(),k("div",$a,[s(w,{class:"self-start","aria-label":"Close",size:"small",severity:"secondary",variant:"outlined",onClick:_[0]||(_[0]=L=>n.value=!e(n))},{default:f(()=>[e(n)?b("",!0):(c(),x(g,{key:0,width:"24",height:"24"})),e(n)?(c(),x(v,{key:1,width:"24",height:"24"})):b("",!0)]),_:1}),s(Q,{name:"fade"},{default:f(()=>[e(n)?(c(),x(V,{key:0,"backtest-history":e(t).activeBot.backtestHistory,"selected-backtest-result-key":e(t).activeBot.selectedBacktestResultKey,"can-use-modify":e(t).activeBot.botApiVersion>=2.32,onSelectionChange:e(t).activeBot.setBacktestResultKey,onRemoveResult:e(t).activeBot.removeBacktestResultFromMemory,onUpdateResult:e(t).activeBot.saveBacktestResultMetadata},null,8,["backtest-history","selected-backtest-result-key","can-use-modify","onSelectionChange","onRemoveResult","onUpdateResult"])):b("",!0)]),_:1})])):b("",!0)],2),u("div",wa,[_[13]||(_[13]=u("h2",{class:"ms-5 text-3xl font-bold"},"백테스팅",-1)),e(t).activeBot.canRunBacktest?b("",!0):(c(),k("p",Ra," 백테스팅을 사용하려면 봇이 웹서버 모드여야 합니다. ")),u("div",Ca,[s(He,{value:"run",lazy:""},{default:f(()=>[s(U,null,{default:f(()=>[e(t).activeBot.botApiVersion>=2.15?(c(),x(A,{key:0,modelValue:e(a),"onUpdate:modelValue":_[1]||(_[1]=L=>D(a)?a.value=L:null),class:"flex items-center",value:"historicResults",disabled:!e(t).activeBot.canRunBacktest},{default:f(()=>[s(h,{class:"me-2"}),_[7]||(_[7]=$("결과 불러오기"))]),_:1},8,["modelValue","disabled"])):b("",!0),s(A,{modelValue:e(a),"onUpdate:modelValue":_[2]||(_[2]=L=>D(a)?a.value=L:null),class:"flex items-center",value:"run",disabled:!e(t).activeBot.canRunBacktest},{default:f(()=>[s(R,{class:"me-2"}),_[8]||(_[8]=$("백테스트 실행"))]),_:1},8,["modelValue","disabled"]),s(A,{id:"bt-analyze-btn",modelValue:e(a),"onUpdate:modelValue":_[3]||(_[3]=L=>D(a)?a.value=L:null),class:"flex items-center",value:"results",disabled:!e(p)},{default:f(()=>[s(F,{class:"me-2"}),_[9]||(_[9]=$("결과 분석"))]),_:1},8,["modelValue","disabled"]),e(r)?(c(),x(A,{key:1,modelValue:e(a),"onUpdate:modelValue":_[4]||(_[4]=L=>D(a)?a.value=L:null),class:"flex items-center",value:"compare-results",disabled:!e(r)},{default:f(()=>[s(J,{class:"me-2"}),_[10]||(_[10]=$("결과 비교"))]),_:1},8,["modelValue","disabled"])):b("",!0),s(A,{modelValue:e(a),"onUpdate:modelValue":_[5]||(_[5]=L=>D(a)?a.value=L:null),class:"flex items-center",value:"visualize-summary",disabled:!e(p)},{default:f(()=>[s(ee,{class:"me-2"}),_[11]||(_[11]=$("요약 시각화"))]),_:1},8,["modelValue","disabled"]),s(A,{modelValue:e(a),"onUpdate:modelValue":_[6]||(_[6]=L=>D(a)?a.value=L:null),class:"flex items-center",value:"visualize",disabled:!e(p)},{default:f(()=>[s(C,{class:"me-2"}),_[12]||(_[12]=$("결과 시각화"))]),_:1},8,["modelValue","disabled"])]),_:1}),s(Ue,null,{default:f(()=>[s(q,{value:"historicResults"},{default:f(()=>[s(j)]),_:1}),s(q,{value:"run"},{default:f(()=>[s(Pe)]),_:1}),s(q,{value:"results"},{default:f(()=>[e(p)?(c(),x(Le,{key:0,"backtest-result":e(t).activeBot.selectedBacktestResult,class:"flex-fill"},null,8,["backtest-result"])):b("",!0)]),_:1}),s(q,{value:"compare-results"},{default:f(()=>[e(r)?(c(),x(De,{key:0,"backtest-results":e(t).activeBot.backtestHistory,class:"flex-fill"},null,8,["backtest-results"])):b("",!0)]),_:1}),s(q,{value:"visualize-summary"},{default:f(()=>[e(p)?(c(),x(ze,{key:0,trades:e(t).activeBot.selectedBacktestResult.trades,class:"flex-fill"},null,8,["trades"])):b("",!0)]),_:1}),s(q,{value:"visualize",l:""},{default:f(()=>[s(Ie,{timeframe:e(l),strategy:e(o).strategy,timerange:e(o).timerange,"backtest-result":e(t).activeBot.selectedBacktestResult,"freqai-model":e(o).freqAI.enabled?e(o).freqAI.model:void 0},null,8,["timeframe","strategy","timerange","backtest-result","freqai-model"])]),_:1})]),_:1})]),_:1}),et(u("small",{class:"text-end bt-running-label"},"백테스트 실행 중: "+B(e(t).activeBot.backtestStep)+" "+B(("formatPercent"in y?y.formatPercent:e(E))(e(t).activeBot.backtestProgress,2)),513),[[st,e(t).activeBot.backtestRunning]])])])])}}}),Ya=I(Ta,[["__scopeId","data-v-b6a629a9"]]);export{Ya as default};
//# sourceMappingURL=BacktestingView-BWaB9lkP.js.map
